<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenReport | Professional Report Generator</title>

    <!-- Custom Styles (includes fallback for Tailwind utilities) -->
    <link rel="stylesheet" href="styles.css">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Critical Inline Styles (Fallback) -->
    <style>
        /* Fallback font */
        @font-face {
            font-family: 'Inter';
            src: local('Inter'), local('Arial'), local('sans-serif');
        }
        
        /* Critical Base Styles */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.5; }
        body { background-color: #f9fafb; color: #111827; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* Critical Layout */
        .flex { display: flex; }
        .flex-1 { flex: 1 1 0%; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        
        /* Critical Sizing */
        .w-8 { width: 2rem; }
        .h-8 { height: 2rem; }
        .w-5 { width: 1.25rem; }
        .h-5 { height: 1.25rem; }
        .w-64 { width: 16rem; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .h-16 { height: 4rem; }
        
        /* Critical Spacing */
        .p-2 { padding: 0.5rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .px-8 { padding-left: 2rem; padding-right: 2rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-1 { margin-top: 0.25rem; }
        .space-y-1 > * + * { margin-top: 0.25rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        
        /* Critical Colors */
        .bg-white { background-color: #ffffff; }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-red-600 { background-color: #dc2626; }
        .text-white { color: #ffffff; }
        .text-gray-400 { color: #9ca3af; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-800 { color: #1f2937; }
        .text-gray-900 { color: #111827; }
        
        /* Critical Typography */
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        
        /* Critical Borders */
        .border { border: 1px solid #e5e7eb; }
        .border-b { border-bottom: 1px solid #e5e7eb; }
        .border-r { border-right: 1px solid #e5e7eb; }
        .border-gray-100 { border-color: #f3f4f6; }
        .border-gray-200 { border-color: #e5e7eb; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        
        /* Critical Effects */
        .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        .overflow-hidden { overflow: hidden; }
        .overflow-y-auto { overflow-y: auto; }
        .z-10 { z-index: 10; }
        
        /* Critical Transitions */
        .transition-colors { transition: color 0.15s, background-color 0.15s, border-color 0.15s; }
        
        /* Hover States */
        .hover\:bg-gray-50:hover { background-color: #f9fafb; }
        .hover\:bg-gray-100:hover { background-color: #f3f4f6; }
        
        /* Sidebar specific */
        nav button { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1.5rem; width: 100%; text-align: left; font-size: 0.875rem; font-weight: 500; color: #4b5563; background: none; border: none; cursor: pointer; transition: background-color 0.15s; }
        nav button:hover { background-color: #f9fafb; }
        
        /* Form elements */
        input, select, textarea { font-family: inherit; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 0.875rem; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #dc2626; box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1); }
        button { cursor: pointer; }
    </style>

    <!-- Icons - Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        // Fallback if Lucide doesn't load
        window.addEventListener('load', function() {
            if (typeof lucide === 'undefined') {
                console.warn('Lucide icons not loaded, using text fallbacks');
                window.lucide = {
                    createIcons: function() {
                        document.querySelectorAll('[data-lucide]').forEach(function(el) {
                            el.textContent = el.getAttribute('data-lucide').charAt(0).toUpperCase();
                            el.style.width = '20px';
                            el.style.height = '20px';
                            el.style.display = 'inline-flex';
                            el.style.alignItems = 'center';
                            el.style.justifyContent = 'center';
                            el.style.fontSize = '12px';
                            el.style.fontWeight = 'bold';
                            el.style.borderRadius = '50%';
                            el.style.backgroundColor = '#e5e7eb';
                        });
                    }
                };
            }
        });
    </script>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Quill.js (Rich Text Editor) -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <!-- Error Handling -->
    <script>
        window.onerror = function (msg, url, line, col, error) {
            // Ignore generic "Script error." as it provides no useful information
            if (msg === 'Script error.' && line === 0) return false;

            const errorBox = document.createElement('div');
            errorBox.style.position = 'fixed';
            errorBox.style.top = '0';
            errorBox.style.left = '0';
            errorBox.style.width = '100%';
            errorBox.style.backgroundColor = '#fee2e2';
            errorBox.style.color = '#991b1b';
            errorBox.style.padding = '20px';
            errorBox.style.zIndex = '9999';
            errorBox.style.fontFamily = 'monospace';
            errorBox.style.borderBottom = '2px solid #b91c1c';
            errorBox.innerHTML = '<strong>⚠️ Application Error:</strong><br>' + msg + '<br><small>' + url + ':' + line + '</small>';
            document.body.appendChild(errorBox);
            return false;
        };
    </script>
</head>

<body class="bg-gray-50 text-gray-900 h-screen overflow-hidden flex flex-col">

    <div id="app" class="flex-1 flex overflow-hidden">
        <!-- App will be mounted here -->
    </div>

    <!-- Core -->
    <script src="js/core/EventBus.js"></script>
    <script src="js/core/Store.js"></script>
    <script src="js/core/Component.js"></script>

    <!-- Services -->
    <script src="js/services/OpenAIService.js"></script>
    <script src="js/services/DocumentService.js"></script>
    <script src="js/services/TokenService.js"></script>
    <script src="js/services/ExportService.js"></script>

    <!-- Config & Profiles (must load before components that use them) -->
    <script src="js/core/ConfigManager.js"></script>
    <script src="js/profiles/ProfileManager.js"></script>
    
    <!-- Data -->
    <script src="js/data/Templates.js"></script>

    <!-- Components -->
    <script src="js/components/Sidebar.js"></script>
    <script src="js/components/SectionManager.js"></script>
    <script src="js/components/GlobalContextManager.js"></script>
    <script src="js/components/ChatAssistant.js"></script>
    <script src="js/components/PreviewModal.js"></script>
    <script src="js/components/ProfileSelector.js"></script>
    <script src="js/components/WelcomeModal.js"></script>
    <script src="js/components/App.js"></script>

    <!-- Initialization -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('OpenReport: Initializing...');
            
            // Check required dependencies
            const deps = {
                'Store': typeof Store !== 'undefined',
                'Component': typeof Component !== 'undefined',
                'EventBus': typeof EventBus !== 'undefined',
                'App': typeof App !== 'undefined',
                'Sidebar': typeof Sidebar !== 'undefined',
                'SectionManager': typeof SectionManager !== 'undefined',
                'GlobalContextManager': typeof GlobalContextManager !== 'undefined',
                'ChatAssistant': typeof ChatAssistant !== 'undefined',
                'PreviewModal': typeof PreviewModal !== 'undefined',
                'WelcomeModal': typeof WelcomeModal !== 'undefined'
            };
            
            const missing = Object.entries(deps).filter(([k, v]) => !v).map(([k]) => k);
            if (missing.length > 0) {
                console.error('Missing dependencies:', missing);
            }
            
            try {
                window.app = new App(document.getElementById('app'));
                window.app.mount();
                if (typeof lucide !== 'undefined' && lucide.createIcons) {
                    lucide.createIcons();
                }
                console.log('OpenReport: Ready!');
            } catch (error) {
                console.error('App initialization error:', error);
                document.getElementById('app').innerHTML = `
                    <div style="padding: 2rem; text-align: center; color: #991b1b;">
                        <h2>Error Loading Application</h2>
                        <p>${error.message}</p>
                        <p style="margin-top: 1rem; font-size: 0.875rem; color: #6b7280;">
                            Try refreshing the page or check the browser console for details.
                        </p>
                    </div>
                `;
            }
        });
    </script>
</body>

</html>